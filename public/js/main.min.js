/*! cryptiblockchain 0.1.0 */
angular.module("insight",["ngAnimate","ngResource","ngRoute","ngProgress","ui.bootstrap","ui.route","monospaced.qrcode","gettext","insight.system","insight.socket","insight.blocks","insight.transactions","insight.address","insight.search","insight.status","insight.connection","insight.currency"]),angular.module("insight.system",[]),angular.module("insight.socket",[]),angular.module("insight.blocks",[]),angular.module("insight.transactions",[]),angular.module("insight.address",[]),angular.module("insight.search",[]),angular.module("insight.status",[]),angular.module("insight.connection",[]),angular.module("insight.currency",[]),angular.module("insight.address").controller("AddressController",function($scope,$rootScope,$routeParams,$location,$http){$scope.getAddress=function(){$http.get("/api/getAccount",{params:{address:$routeParams.address}}).then(function(resp){resp.data.success&&($scope.address=resp.data)})},$scope.loadTrs=function(){$http.get("/api/getTransactionsByAddress",{params:{address:$routeParams.address}}).then(function(resp){resp.data.success&&($scope.txs=resp.data.transactions)})},$scope.loadMore=function(){},$scope.address={address:$routeParams.address},$scope.getAddress()}),angular.module("insight.blocks").controller("BlocksController",function($scope,$rootScope,$routeParams,$location,$http){$scope.getLastBlocks=function(n){var offset=0;n&&(offset=20*(n-1)),$http.get("/api/lastBlocks?n="+offset).then(function(resp){resp.data.success?($scope.blocks=resp.data.blocks,resp.data.pagination&&($scope.pagination=resp.data.pagination)):$scope.blocks=[]})},$scope.getBlock=function(blockId){$http.get("/api/getBlock",{params:{blockId:blockId}}).then(function(resp){if(resp.data.success)return $scope.block=resp.data.block,$http.get("/api/getTransactionsByBlock",{params:{blockId:blockId}});throw"Block was not found!"}).then(function(resp){if(!resp.data.success)throw"Block transactions were not found!";$scope.block.transactions=resp.data.transactions,$scope.txs=$scope.block.transactions})["catch"](function(error){console.log(error),$location.path("/")})},$routeParams.blockId?($scope.block={id:$routeParams.blockId},$scope.getBlock($routeParams.blockId)):$routeParams.blockDate?$scope.getLastBlocks($routeParams.blockDate):$scope.getLastBlocks()}),angular.module("insight.connection").controller("ConnectionController",function(){}),angular.module("insight.currency").controller("CurrencyController",function(){}),angular.module("insight.system").controller("FooterController",function($scope,Version){var _getVersion=function(){Version.get({},function(res){$scope.version=res.version})};$scope.version=_getVersion()}),angular.module("insight.system").controller("HeaderController",function($scope,$rootScope,$modal,$http,$interval){$scope.getHeight=function(){$http.get("/api/getBlocksCount").then(function(resp){resp.data.success?$scope.totalBlocks=resp.data.count:$scope.totalBlocks||($scope.totalBlocks=0)})},$scope.getFee=function(){$http.get("/api/getFee").then(function(resp){$scope.fee=resp.data.success?resp.data.feePercent:"Error"})},$scope.getXCR=function(){$http.get("/api/getXCRCourse").then(function(resp){resp.data.success?($scope.xcr=resp.data.xcr,$scope.usd=resp.data.usd):$scope.course="Error"})},$scope.heightInterval=$interval(function(){$scope.getHeight()},3e4),$scope.feeInterval=$interval(function(){$scope.getFee()},3e4),$scope.xcrInterval=$interval(function(){$scope.getXCR()},3e4),$scope.getHeight(),$scope.getFee(),$scope.getXCR()});var TRANSACTION_DISPLAYED=20,BLOCKS_DISPLAYED=20;angular.module("insight.system").controller("IndexController",function($scope,$http,$interval){$scope.getLastBlocks=function(){$http.get("/api/lastBlocks").then(function(resp){resp.data.success&&($scope.blocks&&$scope.blocks.length>0?$scope.blocks[0].id!=resp.data.blocks[0].id&&($scope.blocks=resp.data.blocks):$scope.blocks=resp.data.blocks)})},$scope.blocksInterval=$interval(function(){$scope.getLastBlocks()},3e4),$scope.getLastBlocks(),$scope.getLastTransactions=function(){$http.get("/api/getLastTransactions").then(function(resp){resp.data.success&&($scope.txs&&$scope.txs.length>0?$scope.txs[0]!=resp.data.txs[0]&&($scope.txs=resp.data.txs):$scope.txs=resp.data.transactions)})},$scope.transactionsInterval=$interval(function(){$scope.getLastTransactions()},3e4),$scope.getLastTransactions()}),angular.module("insight.system").controller("ScannerController",function(){}),angular.module("insight.search").controller("SearchController",function($scope,$routeParams,$location,$timeout,Global,$http){$scope.loading=!1,$scope.badQuery=!1;var _badQuery=function(){$scope.badQuery=!0,$timeout(function(){$scope.badQuery=!1},2e3)},_resetSearch=function(){$scope.q="",$scope.loading=!1};$scope.search=function(){$scope.badQuery=!1,$scope.loading=!0,$http.get("/api/search",{params:{id:$scope.q}}).then(function(resp){0==resp.data.success||0==resp.data.found?($scope.loading=!1,_badQuery()):resp.data.id&&($scope.loading=!1,_resetSearch(),$location.path("/"+resp.data.type+"/"+resp.data.id))})}}),angular.module("insight.status").controller("StatusController",function(){}),angular.module("insight.address").controller("TopAccounts",function($scope,$rootScope,$routeParams,$location,$http){$scope.getTopAccounts=function(){$http.get("/api/getTopAccounts").then(function(resp){resp.data.success&&($scope.topAccounts=resp.data.accounts)})},$scope.getTopAccounts()}),angular.module("insight.transactions").controller("transactionsController",function($scope,$rootScope,$routeParams,$location,$http){$scope.getTransaction=function(){$http.get("/api/getTransaction",{params:{transactionId:$routeParams.txId}}).then(function(resp){resp.data.success&&($scope.tx=resp.data.transaction)})},$scope.getTransaction()}),angular.module("insight.address").factory("Address",function($resource){return $resource("/api/addr/:addrStr/?noTxList=1",{addrStr:"@addStr"},{get:{method:"GET",interceptor:{response:function(res){return res.data},responseError:function(res){return 404===res.status?res:void 0}}}})}),angular.module("insight.blocks").factory("Block",function($resource){return $resource("/api/block/:blockHash",{blockHash:"@blockHash"},{get:{method:"GET",interceptor:{response:function(res){return res.data},responseError:function(res){return 404===res.status?res:void 0}}}})}).factory("Blocks",function($resource){return $resource("/api/blocks")}).factory("BlockByHeight",function($resource){return $resource("/api/block-index/:blockHeight")}),angular.module("insight.currency").factory("Currency",function($resource){return $resource("/api/currency")}),angular.module("insight.system").factory("Global",[function(){}]).factory("Version",function($resource){return $resource("/api/version")});var ScopedSocket=function(socket,$rootScope){this.socket=socket,this.$rootScope=$rootScope,this.listeners=[]};ScopedSocket.prototype.removeAllListeners=function(opts){opts||(opts={});for(var i=0;i<this.listeners.length;i++){var details=this.listeners[i];opts.skipConnect&&"connect"===details.event||this.socket.removeListener(details.event,details.fn)}this.listeners=[]},ScopedSocket.prototype.on=function(event,callback){var socket=this.socket,$rootScope=this.$rootScope,wrapped_callback=function(){var args=arguments;$rootScope.$apply(function(){callback.apply(socket,args)})};socket.on(event,wrapped_callback),this.listeners.push({event:event,fn:wrapped_callback})},ScopedSocket.prototype.emit=function(event,data,callback){var socket=this.socket,$rootScope=this.$rootScope;socket.emit(event,data,function(){var args=arguments;$rootScope.$apply(function(){callback&&callback.apply(socket,args)})})},angular.module("insight.socket").factory("getSocket",function($rootScope){var socket=io.connect(null,{reconnect:!0,"reconnection delay":500});return function(scope){var scopedSocket=new ScopedSocket(socket,$rootScope);return scope.$on("$destroy",function(){scopedSocket.removeAllListeners()}),socket.on("connect",function(){scopedSocket.removeAllListeners({skipConnect:!0})}),scopedSocket}}),angular.module("insight.status").factory("Status",function($resource){return $resource("/api/status",{q:"@q"})}).factory("Sync",function($resource){return $resource("/api/sync")}).factory("PeerSync",function($resource){return $resource("/api/peer")}),angular.module("insight.transactions").factory("Transaction",function($resource){return $resource("/api/tx/:txId",{txId:"@txId"},{get:{method:"GET",interceptor:{response:function(res){return res.data},responseError:function(res){return 404===res.status?res:void 0}}}})}).factory("TransactionsByBlock",function($resource){return $resource("/api/txs",{block:"@block"})}).factory("TransactionsByAddress",function($resource){return $resource("/api/txs",{address:"@address"})}).factory("Transactions",function($resource){return $resource("/api/txs")});var ZeroClipboard=window.ZeroClipboard;angular.module("insight").directive("scroll",function($window){return function(scope){angular.element($window).bind("scroll",function(){scope.secondaryNavbar=this.pageYOffset>=200?!0:!1,scope.$apply()})}}).directive("whenScrolled",function($window){return{restric:"A",link:function(scope,elm,attr){var pageHeight,clientHeight,scrollPos;$window=angular.element($window);var handler=function(){pageHeight=window.document.documentElement.scrollHeight,clientHeight=window.document.documentElement.clientHeight,scrollPos=window.pageYOffset,pageHeight-(scrollPos+clientHeight)===0&&scope.$apply(attr.whenScrolled)};$window.on("scroll",handler),scope.$on("$destroy",function(){return $window.off("scroll",handler)})}}}).directive("clipCopy",function(){return ZeroClipboard.config({moviePath:"/lib/zeroclipboard/ZeroClipboard.swf",trustedDomains:["*"],allowScriptAccess:"always",forceHandCursor:!0}),{restric:"A",scope:{clipCopy:"=clipCopy"},template:'<div class="tooltip fade right in"><div class="tooltip-arrow"></div><div class="tooltip-inner">Copied!</div></div>',link:function(scope,elm){var clip=new ZeroClipboard(elm);clip.on("load",function(client){var onMousedown=function(client){client.setText(scope.clipCopy)};client.on("mousedown",onMousedown),scope.$on("$destroy",function(){client.off("mousedown",onMousedown)})}),clip.on("noFlash wrongflash",function(){return elm.remove()})}}}),angular.module("insight").filter("startFrom",function(){return function(input,start){return start=+start,input.slice(start)}}).filter("split",function(){return function(input,delimiter){var delimiter=delimiter||",";return input.split(delimiter)}}).filter("timestamp",function(){return function(timestamp){var epoch_date=new Date(Date.UTC(2014,4,2,0,0,0,0)),timestamp=parseInt(epoch_date.getTime()/1e3+timestamp),d=new Date(1e3*timestamp),month=d.getMonth()+1;10>month&&(month="0"+month);var day=d.getDate();10>day&&(day="0"+day);var h=d.getHours(),m=d.getMinutes(),s=d.getSeconds();return 10>h&&(h="0"+h),10>m&&(m="0"+m),10>s&&(s="0"+s),d.getFullYear()+"/"+month+"/"+day+" "+h+":"+m+":"+s}}),angular.module("insight").config(function($routeProvider){$routeProvider.when("/block/:blockId",{templateUrl:"/views/block.html",title:"Block "}).when("/block-index/:blockHeight",{controller:"BlocksController",templateUrl:"/views/redirect.html"}).when("/tx/:txId/:v_type?/:v_index?",{templateUrl:"/views/transaction.html",title:"Transaction "}).when("/",{templateUrl:"/views/index.html",title:"Home"}).when("/blocks",{templateUrl:"/views/block_list.html",title:"Blocks List"}).when("/blocks-date/:blockDate?",{templateUrl:"/views/block_list.html",title:"Blocks List"}).when("/address/:address",{templateUrl:"/views/address.html",title:"Address"}).when("/topAccounts",{templateUrl:"/views/topAccounts.html",title:"Top Accounts"}).otherwise({templateUrl:"/views/404.html",title:"Error"})}),angular.module("insight").config(function($locationProvider){$locationProvider.html5Mode(!0),$locationProvider.hashPrefix("!")}).run(function($rootScope,$route,$location,$routeParams,$anchorScroll,ngProgress,gettextCatalog){gettextCatalog.currentLanguage="en",$rootScope.$on("$routeChangeStart",function(){ngProgress.start()}),$rootScope.$on("$routeChangeSuccess",function(){ngProgress.complete(),$rootScope.titleDetail="",$rootScope.title=$route.current.title,$rootScope.isCollapsed=!0,$rootScope.currentAddr=null,$location.hash($routeParams.scrollTo),$anchorScroll()})}),angular.element(document).ready(function(){}),angular.module("insight").run(["gettextCatalog",function(){}]);